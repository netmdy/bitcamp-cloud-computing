<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8'>
<title>팀 보기</title>
</head>
<body>
<h1>팀 보기</h1>
<form action='update' method='post'>
<table border='1'>
<tr>
    <th>팀명</th>
    <td><input type="text" id="eName" readonly></td>
</tr>
<tr>
    <th>설명</th>
    <td><textarea id="eDescription" 
        rows="6" cols="60"></textarea></td>
</tr>
<tr>
    <th>최대인원</th>
    <td><input type="number" id="eMaxQty" ></td>
</tr>
<tr>
    <th>시작일</th>
    <td><input type="date" id="eStartDate" ></td>
</tr>
<tr>
    <th>종료일</th>
    <td><input type="date" id="eEndDate" ></td>
</tr>
</table>
<p>
<button id="eListBtn" type="button">목록</button>
   <button id="eUpdateBtn" type="button" class="viewform">변경</button>
   <button id="eDeleteBtn" type="button" class="viewform">삭제</button>
   <button id="eAddBtn" type="button" class="newform">등록</button>
<a href='${team.name}/task/list' class="viewform">작업목록</a>
</p>
</form>

<h2>회원 목록</h2>
<form action='member/add' method='post'>
<input type='text' id='eMemberId' placeholder='회원아이디'>
<input type='hidden' id='eTeamName'>
<button>추가</button>
</form>
<table border='1' id="eListTable" class="viewform">
<tr><th>아이디</th><th>이메일</th><th> </th></tr>
<tbody></tbody>


</table>
<script type="text/javascript" src="../js/common.js"></script>
<script type="text/javascript">
var data = null;
let tbody = document.querySelector('#eListTable > tbody');
var {name, page, size} = parseQuery(location.href);
if (name == undefined){// 아이디를 지정하지 않으면 입력폼
    var el = document.querySelectorAll('.viewform');
    for (var e of el){
        e.style.display = 'none';
    }
    eName.removeAttribute("readonly");
}else{
    var el = document.querySelectorAll('.newform');
    for (var e of el){
        e.style.display = 'none';
    }
        var xhr = new XMLHttpRequest();
    
    xhr.onreadystatechange = function(){
    
      if (xhr.readyState < 4) return;
      if (xhr.status != 200){
          alert("오류 발생 ㅇㅅㅇ");
          return;
      }
     
    //서버에서 받은 JSON 문자열을 파싱하여 자바스크립트 객체로 바꾼 다음에 사용
        data = JSON.parse(xhr.responseText);
        if (data.team == null){
            alert('팀이 없습니다.');
            location.href = "list.html";
            return;
        }
        eName.value = data.team.name;
        eTeamName.value = data.team.name;
        eDescription.innerHTML = data.team.description;
        eMaxQty.value = data.team.maxQty;
        eStartDate.value = data.team.startDate;
        eEndDate.value = data.team.endDate;
        
        tbody.innerHTML = "";
        console.log(data.team.members)
        if (data.team.members.length == 0){
        var tr = document.createElement("tr");
            tr.innerHTML = '등록된 회원이 없습니다.';
			    tbody.appendChild(tr);
        }else{
            for (var team of data.team.members){
            var tr = document.createElement("tr");
            tr.innerHTML = 
			   `<td><input type="text" id="eId" readonly value=${team.id}></td>
			    <td><input type="email" id="eEmail" value=${team.email} readonly></td>
			    <td><a href='#'>삭제</a></td>`;
			    tbody.appendChild(tr);
            }
        }
			    //<td><a href='member/delete?teamName=${team.name}&memberId=${team.id}'>삭제</a></td>`;
    
    };
    
    xhr.open('GET',
            `../../json/team/view/${name}`,true);
    xhr.send();
}
eListBtn.onclick = function() {
    if (page) {
       location.href = `list.html?page=${page}&size=${size}`;
    } else {
        location.href = 'list.html';
    }
}

</script>

</body>
</html>

    